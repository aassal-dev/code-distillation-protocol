# Strategy Evaluation: The Codebase Distillation Protocol (v0.2.05)

**Status:** v0.2.04 + BMAD-derived improvements (mandate block, write-as-you-go, validation on-demand, workflow map, post–Phase 1 ask). Optional 4-phase or 3-phase; config, state, checklist, batching, tag index preserved.

---

## 1. Executive summary

The protocol performs **active extraction** of engineering wisdom from codebases into a **Global Library** of atomic patterns and tricks (cunning, novel, masterful). v0.2.05 adds to v0.2.04:

- **MANDATE (non-skippable):** Order, write-as-you-go, validation on-demand in the orchestrator.
- **Post–Phase 1 ask:** [c] Continue, [p] Pause, [y] YOLO (no further confirmations).
- **Load strategy:** Documented in workflow.md (load at init vs store path, load when needed).
- **Workflow map:** Phase | Step | Produces | Consumed by; context continuity line.
- **References:** BMAD-METHOD distillation/library patterns (workflow-rules, validation on-demand, save-after-template-output, phase map, post-checkpoint ask).

**Execution:** Unchanged branch logic (use_director → step-00 then 01→02→03, else 01→02→03). One pipeline, one schema, one config; Blueprint remains an extension on top.

---

## 2. Ecosystem context

| Format / artifact          | Purpose                | How we use it                                                                                                                                                                       |
| -------------------------- | ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **workflow.yaml**          | Config and paths       | use_director, optional blueprint_file/theory_context_path; extraction_root, output_plan, output_objectives, output_findings, output_library, validation, batch_size, exclude_paths. |
| **extraction-state.json**  | Resume and progress    | current_phase, director_done (when use_director), targets_done, findings_count; skip completed work.                                                                                |
| **learning_objectives.md** | Intent (4-phase)       | 3–7 Learning Targets; Surveyor ties extraction_plan focus to these when present.                                                                                                    |
| **checklist.md**           | Validation             | Plan mix, Director output when use_director, finding/pattern filenames and frontmatter, no common-knowledge in library, README present; v0.2.05: mandate + workflow map item.       |
| **library/README.md**      | Tag index and contract | Summary counts, tag categories, naming, quick lookup.                                                                                                                               |
| **.cursorrules / .mdc**    | AI instructions        | Output: we generate AI Rule blocks for pattern files.                                                                                                                               |
| **skill.md**               | Agent tools            | Distinct: library provides wisdom (brain), not only tools (hands).                                                                                                                  |

---

## 3. Fractal extraction methodology

Four abstraction levels (unchanged; enforced in plan schema and template):

1. **System:** Architecture, caching, cross-component flows.
2. **Module:** Design patterns, folder structure, dependency boundaries.
3. **Class:** API design, method signatures, encapsulation.
4. **Line-Level ("metal"):** Bitwise tricks, regex, loop optimizations, language-specific mastery.

Plan must include at least one Line-Level target; template and checklist enforce abstraction and quality (cunning | novel | masterful).

---

## 4. Orchestration architecture (v0.2.05)

- **Driver:** v0.2.05 Orchestrator (in-editor driver). Paste into Composer; it references workflow.md, workflow.yaml, and steps from the **V0.2.05** folder.
- **Init:** Load config → resolve paths → discover state (find-config-resolve-path-discover). **Load strategy:** load at init (workflow, config, steps, state); note validation path only; load checklist when Phase 3 runs.
- **MANDATE:** Order (exact phase order; resume state-driven); write-as-you-go (write finding + update state after each target/batch); validation on-demand (load checklist in Phase 3 only).
- **Phase 0 (optional):** step-00-director.md → learning_objectives.md; optional implementation_map.json when Blueprint provided. Only when use_director is true.
- **Phase 1 (Survey):** step-01-survey.md → extraction_plan.json; **then ask:** [c] Continue, [p] Pause, [y] YOLO. WAIT for response.
- **Phase 2 (Atomize):** step-02-atomize.md → findings per target; write-as-you-go mandate; optional "Theory vs. Practice" when Blueprint run; state updated per target/batch; batching when many targets.
- **Phase 3 (Librarian):** step-03-librarian.md → merge, discard common knowledge (record count), pattern\_\*.md to library, library/README.md, run checklist; preserve Theory vs. Practice when present. Do not delete findings until validated.

---

## 5. Scoring (v0.2.05)

| Metric               | Score | Notes                                                                                                                          |
| -------------------- | ----- | ------------------------------------------------------------------------------------------------------------------------------ |
| **Automation**       | 10/10 | Zero context switching; IDE is the runtime. Config and state enable future automation.                                         |
| **Precision/Intent** | 10/10 | When Director used: top-down intent (Learning Targets) reduces hallucination and wasted tokens; Surveyor maps code to targets. |
| **Granularity**      | 10/10 | Fractal extraction + single template + quality gate and tag index.                                                             |
| **UX**               | 10/10 | Single driver file; explicit post–Phase 1 ask (c/p/y); resume reduces re-work; 3-phase still valid when use_director false.    |
| **Structure**        | 10/10 | Micro-file workflow, config-driven paths, mandate block, load strategy, workflow map, explicit checklist and library contract. |
| **Resumability**     | 9/10  | State file supports director_done and "resume from Phase 2/3"; no automated runner yet.                                        |

---

## 6. Improvements in v0.2.05 (over v0.2.04)

- **MANDATE block:** Non-skippable rules in orchestrator (order, write-as-you-go, validation on-demand).
- **Post–Phase 1 ask:** [c] Continue, [p] Pause, [y] YOLO; wait for response; YOLO = no further asks this run.
- **Load strategy:** workflow.md documents load-at-init vs store-path-load-when-needed (validation, optional Blueprint).
- **Workflow map:** Phase | Step | Produces | Consumed by table + context continuity in workflow.md.
- **Write-as-you-go:** Explicit mandate in Phase 2 and in MANDATE block.
- **Checklist:** Optional item for orchestrator mandate and workflow map presence.
- **BMAD references:** Orchestrator and workflow.md cite distillation/library patterns that informed these rules.

All v0.2.04 capabilities retained: Director, Blueprint, config, state, resume, checklist, batching, library README, single template, exclude_paths.
