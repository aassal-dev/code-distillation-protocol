# Strategy Evaluation: The Codebase Distillation Protocol (v0.2.0)

**Status:** Minor Release — Workflow structure, config, state, checklist, batching, tag index.

---

## 1. Executive summary

The protocol performs **active extraction** of engineering wisdom from codebases into a **Global Library** of atomic patterns and tricks (cunning, novel, masterful). v0.2.0 adds a **micro-file workflow** (workflow.md + steps), **config-driven paths** (workflow.yaml), **state and resume** (extraction-state.json), **validation** (checklist.md), **batching**, and a **library tag index** (library/README.md).

**Core mechanism:** In-editor execution via Cursor Composer, driven by the Orchestrator (v0.2.0), which loads workflow + config, resolves paths, discovers state for resume, and runs step-01 → step-02 → step-03 in order.

---

## 2. Ecosystem context

| Format / artifact         | Purpose                | How we use it                                                                                        |
| ------------------------- | ---------------------- | ---------------------------------------------------------------------------------------------------- |
| **workflow.yaml**         | Config and paths       | extraction_root, output_plan/findings/library, validation, batch_size, exclude_paths.                |
| **extraction-state.json** | Resume and progress    | current_phase, targets_done, findings_count; skip completed work.                                    |
| **checklist.md**          | Validation             | Plan mix, finding/pattern filenames and frontmatter, no common-knowledge in library, README present. |
| **library/README.md**     | Tag index and contract | Summary counts, tag categories, naming, quick lookup.                                                |
| **.cursorrules / .mdc**   | AI instructions        | Output: we generate AI Rule blocks for pattern files.                                                |
| **skill.md**              | Agent tools            | Distinct: library provides wisdom (brain), not only tools (hands).                                   |

---

## 3. Fractal extraction methodology

Four abstraction levels (unchanged from v0.1.0, now enforced in plan schema and template):

1. **System:** Architecture, caching, cross-component flows.
2. **Module:** Design patterns, folder structure, dependency boundaries.
3. **Class:** API design, method signatures, encapsulation.
4. **Line-Level (“metal”):** Bitwise tricks, regex, loop optimizations, language-specific mastery.

Plan must include at least one Line-Level target; template and checklist enforce abstraction and quality (cunning | novel | masterful).

---

## 4. Orchestration architecture (v0.2.0)

- **Driver:** v0.2.0 Orchestrator (this workflow’s in-editor driver). Paste into Composer; it references workflow.md, workflow.yaml, and steps.
- **Init:** Load config → resolve paths → discover state (find-config-resolve-path-discover). Two-tier: config first, then paths, then discovery.
- **Step 1 (Survey):** step-01-survey.md → extraction_plan.json; optional state update.
- **Step 2 (Atomize):** step-02-atomize.md → findings per target; write-as-you-go; state updated per target/batch; batching when many targets.
- **Step 3 (Librarian):** step-03-librarian.md → merge, discard common knowledge (record count), pattern\_\*.md to library, library/README.md, run checklist; do not delete findings until validated.

---

## 5. Scoring (v0.2.0)

| Metric           | Score | Notes                                                                                        |
| ---------------- | ----- | -------------------------------------------------------------------------------------------- |
| **Automation**   | 10/10 | Still zero context switching; IDE is the runtime. Config and state enable future automation. |
| **Granularity**  | 10/10 | Fractal extraction + single template + quality gate and tag index.                           |
| **UX**           | 10/10 | Single driver file; optional pause after Phase 1; resume reduces re-work.                    |
| **Structure**    | 10/10 | Micro-file workflow, config-driven paths, explicit checklist and library contract.           |
| **Resumability** | 9/10  | State file supports “resume from Phase 2/3”; no automated runner yet.                        |

---

## 6. Improvements over v0.1.0

- **Workflow split:** Clear step files with MANDATORY RULES, CONTEXT BOUNDARIES, YOUR TASK, DISCOVERY/EXECUTION SEQUENCE.
- **Config:** Paths and options in workflow.yaml; no hardcoded paths in prompts.
- **State and resume:** extraction-state.json; skip completed phases or targets.
- **Validation:** checklist.md run after Phase 3; plan mix, frontmatter, no common-knowledge in library, README present.
- **Batching:** Phase 2 and Phase 3 can process in batches to avoid context overflow.
- **Tag index:** library/README.md as contract (summary, tag categories, naming, quick lookup).
- **Single schema:** One extraction_plan shape; one finding/pattern template (quality + source_path required).
