# The Codebase Distillation Protocol (In-Editor Driver)

**Version:** 0.1.0

**Type:** Agent Protocol / Meta-Prompt

**Execution Environment:** Cursor Composer (Cmd+I) or Claude Code

**Prerequisite:** Open the target repository (e.g., BMad) in Cursor.

## ðŸš€ How to Run This

1. **Open Cursor Composer (Cmd+I).**
    
2. **Copy & Paste** the text below into the chat.
    
3. **Hit Enter.**
    

## ðŸ¤– The Protocol Instructions

I want you to act as a **Reverse Engineering Agent** to distill this codebase. Follow these phases sequentially. Pause after Phase 1 for my confirmation if needed, otherwise proceed.

### Phase 1: The Surveyor (Map the Territory)

**Goal:** Identify **ALL** areas of high engineering complexity.

**Action:**

1. Scan the file tree, `package.json`, and `README.md`.
    
2. Identify "Nerve Centers" (complex logic, custom engines, performance layers).
    
3. **Create a file** named `_distillation/extraction_plan.json`.
    

**JSON Format for Output:**

```
[
  { "id": "01", "path": "src/core/agent_loop.py", "focus": "Orchestration Logic", "depth": "System" },
  { "id": "02", "path": "src/utils/memory.py", "focus": "Optimization", "depth": "Line-Level" }
]
```

_Constraint:_ Do not limit the number of targets. Capture everything valuable.

### Phase 2: The Atomizer (Execute the Extraction)

**Goal:** Extract Atomic Patterns.

**Action:**

Read `_distillation/extraction_plan.json`. Iterate through **every** target. For each target:

1. Read the source code at the `path`.
    
2. Analyze it for 'Cunning Tricks', 'Patterns', or 'Optimizations' based on the `focus`.
    
3. **Generate a new Markdown file** in `_distillation/findings/` for each distinct pattern.
    
4. **Filename:** `finding_{id}_{pattern_name}.md`.
    

**Content Template (Strictly Follow This):**

```
---
id: [unique-id]
type: [pattern | optimization | anti-pattern]
tags: [tag1, tag2]
depth: [System | Module | Line-Level]
---
# Insight: [Name]
## The Trick
[Explanation of the clever engineering decision]
## The "Why"
[Why is this better than the standard approach?]
## Code Snippet
[The specific code block]
## AI Rule
[A cursor rule block instructing an AI how to use this]
```

### Phase 3: The Librarian (Final Polish)

**Goal:** Consolidate and Clean.

**Action:**

1. Read all files in `_distillation/findings/`.
    
2. Merge duplicates.
    
3. Delete low-value findings (common knowledge).
    
4. **Move** valid files to `_distillation/library/`.
    
5. **Delete** the raw `_distillation/findings/` folder.