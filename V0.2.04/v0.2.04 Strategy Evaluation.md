# Strategy Evaluation: The Codebase Distillation Protocol (v0.2.04)

**Status:** Consolidation release — v0.2.0 (full) + v0.2.03 (Director + optional Blueprint). Optional 4-phase or 3-phase; Precision/Intent Layer when Director used; config, state, checklist, batching, tag index preserved.

---

## 1. Executive summary

The protocol performs **active extraction** of engineering wisdom from codebases into a **Global Library** of atomic patterns and tricks (cunning, novel, masterful). v0.2.04 consolidates:

- **v0.2.0:** Micro-file workflow (workflow.md + steps), config-driven paths (workflow.yaml), state and resume (extraction-state.json), validation (checklist.md), batching, library tag index (library/README.md), single template, `target_id` / `abstraction_level` schema.
- **v0.2.03:** Optional **Director** (Phase 0) producing learning_objectives.md (3–7 Learning Targets); Surveyor maps code to those targets when present; optional **Blueprint Extraction** (theory file → implementation_map.json, "Theory vs. Practice" in artifacts).

**Execution:** When `use_director: true` (default), run step-00 (Director) → step-01 (Survey) → step-02 (Atomize) → step-03 (Librarian). When `use_director: false`, run step-01 → step-02 → step-03 (3-phase, same as v0.2.0). One pipeline, one schema, one config; Blueprint is an extension on top.

---

## 2. Ecosystem context

| Format / artifact          | Purpose                | How we use it                                                                                                                                                                       |
| -------------------------- | ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **workflow.yaml**          | Config and paths       | use_director, optional blueprint_file/theory_context_path; extraction_root, output_plan, output_objectives, output_findings, output_library, validation, batch_size, exclude_paths. |
| **extraction-state.json**  | Resume and progress    | current_phase, director_done (when use_director), targets_done, findings_count; skip completed work.                                                                                |
| **learning_objectives.md** | Intent (4-phase)       | 3–7 Learning Targets; Surveyor ties extraction_plan focus to these when present.                                                                                                    |
| **checklist.md**           | Validation             | Plan mix, Director output when use_director, finding/pattern filenames and frontmatter, no common-knowledge in library, README present.                                             |
| **library/README.md**      | Tag index and contract | Summary counts, tag categories, naming, quick lookup.                                                                                                                               |
| **.cursorrules / .mdc**    | AI instructions        | Output: we generate AI Rule blocks for pattern files.                                                                                                                               |
| **skill.md**               | Agent tools            | Distinct: library provides wisdom (brain), not only tools (hands).                                                                                                                  |

---

## 3. Fractal extraction methodology

Four abstraction levels (unchanged; enforced in plan schema and template):

1. **System:** Architecture, caching, cross-component flows.
2. **Module:** Design patterns, folder structure, dependency boundaries.
3. **Class:** API design, method signatures, encapsulation.
4. **Line-Level ("metal"):** Bitwise tricks, regex, loop optimizations, language-specific mastery.

Plan must include at least one Line-Level target; template and checklist enforce abstraction and quality (cunning | novel | masterful).

---

## 4. Orchestration architecture (v0.2.04)

- **Driver:** v0.2.04 Orchestrator (in-editor driver). Paste into Composer; it references workflow.md, workflow.yaml, and steps.
- **Init:** Load config → resolve paths → discover state (find-config-resolve-path-discover). Two-tier: config first, then paths, then discovery.
- **Phase 0 (optional):** step-00-director.md → learning_objectives.md; optional implementation_map.json when Blueprint provided. Only when use_director is true.
- **Phase 1 (Survey):** step-01-survey.md → extraction_plan.json; when learning_objectives.md exists, focus tied to Learning Targets; else nerve centers by complexity. Optional state update.
- **Phase 2 (Atomize):** step-02-atomize.md → findings per target; write-as-you-go; optional "Theory vs. Practice" when Blueprint run; state updated per target/batch; batching when many targets.
- **Phase 3 (Librarian):** step-03-librarian.md → merge, discard common knowledge (record count), pattern\_\*.md to library, library/README.md, run checklist; preserve Theory vs. Practice when present. Do not delete findings until validated.

---

## 5. Scoring (v0.2.04)

| Metric               | Score | Notes                                                                                                                          |
| -------------------- | ----- | ------------------------------------------------------------------------------------------------------------------------------ |
| **Automation**       | 10/10 | Zero context switching; IDE is the runtime. Config and state enable future automation.                                         |
| **Precision/Intent** | 10/10 | When Director used: top-down intent (Learning Targets) reduces hallucination and wasted tokens; Surveyor maps code to targets. |
| **Granularity**      | 10/10 | Fractal extraction + single template + quality gate and tag index.                                                             |
| **UX**               | 10/10 | Single driver file; optional pause after Phase 1; resume reduces re-work; 3-phase still valid when use_director false.         |
| **Structure**        | 10/10 | Micro-file workflow, config-driven paths, explicit checklist and library contract.                                             |
| **Resumability**     | 9/10  | State file supports director_done and "resume from Phase 2/3"; no automated runner yet.                                        |

---

## 6. Improvements in v0.2.04 (over v0.2.0)

- **Optional Director (Phase 0):** learning_objectives.md with 3–7 Learning Targets; Surveyor ties extraction_plan focus to those targets when file exists. Config flag `use_director` (default true) preserves 3-phase runs when false.
- **Optional Blueprint:** When user provides a theory/Blueprint file, Director can derive learning_objectives and optionally output implementation_map.json; Atomizer adds "Theory vs. Practice" to artifacts. Documented as add-on; core pipeline stays one path.
- **Schema:** Everywhere `target_id` and `abstraction_level` (no id/depth). State schema extended with `director_done`; phase names: director, survey, atomize, librarian.
- All v0.2.0 capabilities retained: config, state, resume, checklist, batching, library README, single template, exclude_paths.
